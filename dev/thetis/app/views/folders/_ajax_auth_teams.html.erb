<% if @folder.nil? %>

<table width="100%" height="100%" bgcolor="lightcyan" cellpadding="0" cellspacing="0">
  <tr>
    <td valign="top">
      <br/><br/><br/>
      <table align="center" width="80%" cellpadding="0" cellspacing="0">
        <tr>
          <td align="left" valign="top" style="padding:10px; color:firebrick; background-color:white; border:5px moccasin dashed;">
            <%=h t('folder.cannot_be_edited') %>
          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>

<% else %>

<table cellspacing="0" cellpadding="0" width="100%" height="100%" bgcolor="lightcyan">
  <tr>
    <td style="vertical-align:top;">
      <table cellspacing="2" cellpadding="0" width="100%">
        <tr>
          <td id="tab_users" class="td_item_tab" nowrap onClick="selectTabUsers(<%= @folder.id %>);" bgColor="silver" onMouseOver="this.bgColor='palegreen'" onMouseOut="this.bgColor='silver';">
              <%= h t('user.plural') %>
          </td>
          <td id="tab_groups" class="td_item_tab" nowrap onClick="selectTabGroups(<%= @folder.id %>);" bgColor="silver" onMouseOver="this.bgColor='palegreen'" onMouseOut="this.bgColor='silver';">
              <%= h t('group.plural') %>
          </td>
          <td id="tab_teams" class="td_item_tab" nowrap  bgColor="brown" style="cursor:default">
              <%= h t('team.plural') %>
          </td>
        </tr>
      </table>
    </td>
  </tr>

  <tr>
    <td style="vertical-align:top;">

      <%= form_tag( {:controller => 'folders', :action => 'set_auth_teams', :id => ''}, :name => 'form_folder_auth', :method => 'post') %>
        <table cellspacing="0" cellpadding="0" width="100%">
          <tr height="10"><td></td></tr>
          <tr>
            <td style="padding:10px;">
              <table cellspacing="0" cellpadding="0" width="100%">
                <tr>
                  <td style="text-align:left;">
                    <%= h t('cap.teams') %><br/>
                    <select id="team_candidates" name="team_candidates" class="select_multi" size="5" multiple="multiple">
                    <%
                     read_teams = @folder.get_read_teams_a
                     write_teams = @folder.get_write_teams_a
                     read_teams = [] if read_teams.nil?
                     write_teams = [] if write_teams.nil?
                     @teams.each do |team|
                       next if read_teams.include?(team.id.to_s)
                       next if write_teams.include?(team.id.to_s)
                    %>
                      <option value="<%=h team.id %>"><%=h team.name %></option>
                    <% end %>
                    </select>
                  </td>
                </tr>
                <tr height="5"><td></td></tr>
                <tr>
                  <td>
                    <table cellspacing="0" cellpadding="0" width="100%">
                      <tr>
                        <td align="center" nowrap>
                          <input type="button" value="<%= raw(t('arrow.down')) %><%=h t('auth.read_write') %>" onclick="var ary=moveListWithSuffix($('team_candidates'), $('teams_auth'), ':r+w', ' (Read/Write)'); if (ary != null && ary.length > 0) {modified_teams++;} return false;">
                          <input type="button" value="<%= raw(t('arrow.down')) %><%=h t('auth.read') %>" onclick="var ary=moveListWithSuffix($('team_candidates'), $('teams_auth'), ':r', ' (Read)'); if (ary != null && ary.length > 0) {modified_teams++;} return false;">
                          <input type="button" value="<%= raw(t('arrow.down')) %><%=h t('auth.write') %>" onclick="var ary=moveListWithSuffix($('team_candidates'), $('teams_auth'), ':w', ' (Write)'); if (ary != null && ary.length > 0) {modified_teams++;} return false;">
                          <input type="button" value="<%= raw(t('arrow.up')) %><%=h t('btn.remove') %>" onclick="var ary=moveListTrimSuffix($('teams_auth'), $('team_candidates'), ':', '('); if (ary != null && ary.length > 0) {modified_teams++;} return false;">
                        </td>
                      </tr>
                    </table>
                  </td>
                </tr>
                <tr height="6"><td></td></tr>
                <tr>
                  <td>
                    <select id="teams_auth" name="teams_auth[]" class="select_multi" size="5" multiple="multiple">
                    <%
                     readWrite = read_teams & write_teams
                     readOnly = read_teams - write_teams
                     writeOnly = write_teams - read_teams
                     readWrite.each do |team_id|
                    %>
                      <option value="<%= team_id %>:r+w"><%=h Team.get_name(team_id) %> (Read/Write)</option>
                    <% end %>
                    <% readOnly.each do |team_id| %>
                      <option value="<%= team_id %>:r"><%=h Team.get_name(team_id) %> (Read)</option>
                    <% end %>
                    <% writeOnly.each do |team_id| %>
                      <option value="<%= team_id %>:w"><%=h Team.get_name(team_id) %> (Write)</option>
                    <% end %>
                    </select>
                  </td>
                </tr>
              </table>
            </td>
          </tr>
          <tr height="20">
            <td>
              <table align="center" cellspacing="0" cellpadding="0">
                <tr height="20"><td></td></tr>
                <tr>
                <td class="img_button_td" onclick="doApplyAuthTeams(<%= @folder.id %>);">
                  <%=h t('btn.apply') %>
                </td>
                </tr>
              </table>
            </td>
          </tr>
          <tr height="15"><td></td></tr>
        </table>
      </form>

    </td>
  </tr>
</table>

<% end %>

<%= render :partial => 'common/flash_notice' %>

<script type="text/javascript">

modified_users = 0;
modified_groups = 0;
modified_teams = 0;

</script>
