<%
hide_root = (params[:hide_root] == 'true')
%>

<script type="text/javascript">
  <%
  group_folder_open = THETIS_RELATIVE_URL_ROOT + '/images/folder/group_folder_open.gif'
  group_folder_close = THETIS_RELATIVE_URL_ROOT + '/images/folder/group_folder_close.gif'
  %>
  var folderImgs = new Array(
                        new Array("<%= group_folder_open %>", "<%= group_folder_close %>")
                      );
  var array = null;
  var firstMenuId = null;
  var retMenuId = null;
<% unless hide_root %>
  array = new Array(new Array("0", "/(root)", "", "", 0));
  firstMenuId = ThetisBox.buildTree("", array, null, "<%= params[:rootDiv] %>", "<%= params[:selKeeper] %>", folderImgs);
<% end %>
<% @group_tree.each do |parent_id, child_groups| %>
  array = new Array(
    <% count = 0 %>
    <% child_groups.each do |group| %>
          new Array("<%= group.id %>", "/<%= group.name %>", "", "", 0)
        <%
          count += 1
          if count < child_groups.length
        %>
          ,
        <%
          end
        %>
    <% end %>
        );
  <%
  if hide_root and (parent_id.to_s == '0')
    parent_id = ''
  end
  %>
  retMenuId = ThetisBox.buildTree("<%= parent_id %>", array, null, "<%= params[:rootDiv] %>", "<%= params[:selKeeper] %>", folderImgs, false);
  if (firstMenuId == null) {
    firstMenuId = retMenuId;
  }
<% end %>
<% if params[:selId].nil? or params[:selId].empty? %>
    ThetisBox.selectTree("<%= params[:selKeeper] %>", firstMenuId, null);
<% else %>
    ThetisBox.selectTree("<%= params[:selKeeper] %>", "<%= params[:selId] %>", null, true);
<% end %>
</script>
